{"ast":null,"code":"/* eslint-disable no-unused-vars */\n\n/* eslint-disable no-nested-ternary */\nimport { firebase, FieldValue } from \"../lib/firebase\";\nimport \"firebase/compat/firestore\";\nconst washingtonRef = FieldValue.collection(\"cities\").doc(\"DC\");\nconst batch = db.batch();\nexport async function doesUsernameExists(username) {\n  const result = await firebase.firestore().collection(\"users\").where(\"username\", \"==\", username).get();\n  return result.docs.length > 0;\n} // get user from the firestore where userId === userId (passed from the auth)\n\nexport async function getUserByUserId(userId) {\n  const result = await firebase.firestore().collection(\"users\").where(\"userId\", \"==\", userId).get();\n  const user = result.docs.map(item => ({ ...item.data(),\n    docId: item.id\n  }));\n  return user;\n} // check all conditions before limit results\n\nexport async function getSuggestedProfiles(userId, following) {\n  let query = firebase.firestore().collection(\"users\");\n\n  if (following.length > 0) {\n    query = query.where(\"userId\", \"not-in\", [...following, userId]);\n  } else {\n    query = query.where(\"userId\", \"!=\", userId);\n  }\n\n  const result = await query.limit(10).get();\n  const profiles = result.docs.map(user => ({ ...user.data(),\n    docId: user.id\n  }));\n  return profiles;\n}\nexport async function updateLoggedInUserFollowing(loggedInUserDocId, // currently logged in user document id (karl's profile)\nprofileId, // the user that karl requests to follow\nisFollowingProfile // true/false (am i currently following this person?)\n) {\n  console.log(\"params is:\", loggedInUserDocId, profileId, isFollowingProfile);\n  return firebase.firestore().collection(\"users\").doc(loggedInUserDocId).update({\n    following: isFollowingProfile ? FieldValue.arrayRemove(...profileId) : FieldValue.arrayUnion(...profileId)\n  });\n}\nexport async function updateFollowedUserFollowers(profileDocId, // currently logged in user document id (karl's profile)\nloggedInUserDocId, // the user that karl requests to follow\nisFollowingProfile // true/false (am i currently following this person?)\n) {\n  return firebase.firestore().collection(\"users\").doc(profileDocId).update({\n    followers: isFollowingProfile ? FieldValue.arrayRemove(loggedInUserDocId) : FieldValue.arrayUnion(loggedInUserDocId)\n  });\n}","map":{"version":3,"sources":["D:/CURSO JS/REACT/instagram/src/services/firebase.js"],"names":["firebase","FieldValue","washingtonRef","collection","doc","batch","db","doesUsernameExists","username","result","firestore","where","get","docs","length","getUserByUserId","userId","user","map","item","data","docId","id","getSuggestedProfiles","following","query","limit","profiles","updateLoggedInUserFollowing","loggedInUserDocId","profileId","isFollowingProfile","console","log","update","arrayRemove","arrayUnion","updateFollowedUserFollowers","profileDocId","followers"],"mappings":"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","sourcesContent":["/* eslint-disable no-unused-vars */\r\n/* eslint-disable no-nested-ternary */\r\n\r\nimport { firebase, FieldValue } from \"../lib/firebase\";\r\nimport \"firebase/compat/firestore\";\r\n\r\nconst washingtonRef = FieldValue.collection(\"cities\").doc(\"DC\");\r\nconst batch = db.batch();\r\n\r\nexport async function doesUsernameExists(username) {\r\n  const result = await firebase\r\n    .firestore()\r\n    .collection(\"users\")\r\n    .where(\"username\", \"==\", username)\r\n    .get();\r\n\r\n  return result.docs.length > 0;\r\n}\r\n// get user from the firestore where userId === userId (passed from the auth)\r\nexport async function getUserByUserId(userId) {\r\n  const result = await firebase\r\n    .firestore()\r\n    .collection(\"users\")\r\n    .where(\"userId\", \"==\", userId)\r\n    .get();\r\n  const user = result.docs.map((item) => ({\r\n    ...item.data(),\r\n    docId: item.id,\r\n  }));\r\n\r\n  return user;\r\n}\r\n\r\n// check all conditions before limit results\r\nexport async function getSuggestedProfiles(userId, following) {\r\n  let query = firebase.firestore().collection(\"users\");\r\n\r\n  if (following.length > 0) {\r\n    query = query.where(\"userId\", \"not-in\", [...following, userId]);\r\n  } else {\r\n    query = query.where(\"userId\", \"!=\", userId);\r\n  }\r\n  const result = await query.limit(10).get();\r\n\r\n  const profiles = result.docs.map((user) => ({\r\n    ...user.data(),\r\n    docId: user.id,\r\n  }));\r\n\r\n  return profiles;\r\n}\r\n\r\nexport async function updateLoggedInUserFollowing(\r\n  loggedInUserDocId, // currently logged in user document id (karl's profile)\r\n  profileId, // the user that karl requests to follow\r\n  isFollowingProfile // true/false (am i currently following this person?)\r\n) {\r\n  console.log(\"params is:\", loggedInUserDocId, profileId, isFollowingProfile);\r\n  return firebase\r\n    .firestore()\r\n    .collection(\"users\")\r\n    .doc(loggedInUserDocId)\r\n    .update({\r\n      following: isFollowingProfile\r\n        ? FieldValue.arrayRemove(...profileId)\r\n        : FieldValue.arrayUnion(...profileId),\r\n    });\r\n}\r\n\r\nexport async function updateFollowedUserFollowers(\r\n  profileDocId, // currently logged in user document id (karl's profile)\r\n  loggedInUserDocId, // the user that karl requests to follow\r\n  isFollowingProfile // true/false (am i currently following this person?)\r\n) {\r\n  return firebase\r\n    .firestore()\r\n    .collection(\"users\")\r\n    .doc(profileDocId)\r\n    .update({\r\n      followers: isFollowingProfile\r\n        ? FieldValue.arrayRemove(loggedInUserDocId)\r\n        : FieldValue.arrayUnion(loggedInUserDocId),\r\n    });\r\n}\r\n"]},"metadata":{},"sourceType":"module"}